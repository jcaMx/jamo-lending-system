import{r,j as e,H as A}from"./app-0d3sklFQ.js";import{A as k}from"./app-layout-BUlHJEIw.js";import"./app-DFC8ppuA.js";import"./button-BT8l82O1.js";import"./utils-CFcDjcb_.js";import"./sheet-KTeoO0_X.js";import"./index-CSfBvJPP.js";import"./index-DCpgsalv.js";import"./index-CIAlwk6f.js";import"./createLucideIcon-292lA348.js";import"./index-BpvsPxZt.js";import"./index-sJV3ACG6.js";import"./index-D_fJ_aXj.js";import"./routes-B8UsKWZ0.js";import"./app-logo-icon-BxrI132f.js";const E=[{title:"Dashboard",href:"/dashboard"},{title:"Reports",href:"/Reports"},{title:"Monthly Report",href:"/Reports/MonthlyReport"}];function _(){const[f,O]=r.useState(""),[m,v]=r.useState("ALL"),[x,L]=r.useState(""),[u,N]=r.useState(""),[c,d]=r.useState(1),h=8,[w,g]=r.useState(!1),b=r.useRef(null),j=[{month:"2025-11",loanReleased:8e5,sixPercentDeduction:48e3,advanceTenPercentDeduction:8e4,LPP:4e5,LIP:4e4,interestType:"10%"},{month:"2025-12",loanReleased:75e4,sixPercentDeduction:0,advanceTenPercentDeduction:75e3,LPP:35e4,LIP:35e3,interestType:"10%"},{month:"2026-01",loanReleased:6e5,sixPercentDeduction:3e4,advanceTenPercentDeduction:0,LPP:3e5,LIP:3e4,interestType:"5%"},{month:"2026-02",loanReleased:7e5,sixPercentDeduction:42e3,advanceTenPercentDeduction:7e4,LPP:38e4,LIP:32e3,interestType:"5%"},{month:"2026-03",loanReleased:9e5,sixPercentDeduction:54e3,advanceTenPercentDeduction:9e4,LPP:5e5,LIP:45e3,interestType:"10%"},{month:"2026-04",loanReleased:55e4,sixPercentDeduction:33e3,advanceTenPercentDeduction:0,LPP:26e4,LIP:26e3,interestType:"5%"},{month:"2026-05",loanReleased:68e4,sixPercentDeduction:40800,advanceTenPercentDeduction:68e3,LPP:34e4,LIP:34e3,interestType:"10%"},{month:"2026-06",loanReleased:72e4,sixPercentDeduction:43200,advanceTenPercentDeduction:72e3,LPP:36e4,LIP:36e3,interestType:"10%"},{month:"2026-07",loanReleased:61e4,sixPercentDeduction:36600,advanceTenPercentDeduction:0,LPP:305e3,LIP:30500,interestType:"5%"},{month:"2026-08",loanReleased:79e4,sixPercentDeduction:47400,advanceTenPercentDeduction:79e3,LPP:395e3,LIP:39500,interestType:"10%"}],l=r.useMemo(()=>j.filter(t=>{const s=P(t.month).toLowerCase().includes(f.toLowerCase()),a=m==="ALL"||t.interestType===m,i=t.month.split("-")[1],o=!x||i===String(x).padStart(2,"0"),F=!u||t.month.startsWith(String(u));return s&&a&&o&&F}),[j,f,m,x,u]),y=Math.max(1,Math.ceil(l.length/h)),D=l.slice((c-1)*h,c*h),p=r.useMemo(()=>l.reduce((t,n)=>(t.loanReleased+=n.loanReleased,t.sixPercentDeduction+=n.sixPercentDeduction,t.advanceTenPercentDeduction+=n.advanceTenPercentDeduction,t.LPP+=n.LPP,t.LIP+=n.LIP,t),{loanReleased:0,sixPercentDeduction:0,advanceTenPercentDeduction:0,LPP:0,LIP:0}),[l]);function P(t){try{const[n,s]=t.split("-").map(Number);return new Date(n,(s??1)-1,1).toLocaleString("default",{month:"long",year:"numeric"})}catch{return t}}const T=()=>{const t=["Month","Loan Released","6% Deduction","Advance 10% Interest","Loan Principal Payment","Loan Interest Payment","Interest Type"],n=l.map(o=>[P(o.month),o.loanReleased.toFixed(2),o.sixPercentDeduction.toFixed(2),o.advanceTenPercentDeduction.toFixed(2),o.LPP.toFixed(2),o.LIP.toFixed(2),o.interestType]),s="data:text/csv;charset=utf-8,"+[t,...n].map(o=>o.join(",")).join(`
`),a=encodeURI(s),i=document.createElement("a");i.href=a,i.download="monthly_report.csv",document.body.appendChild(i),i.click(),document.body.removeChild(i),g(!1)},R=async()=>{try{const t=await fetch("/reports/mcpr/export-pdf",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")??""},body:JSON.stringify({rows:l})});if(!t.ok)throw new Error(`Export failed (${t.status})`);const n=await t.blob(),s=window.URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download="Monthly_Report.pdf",document.body.appendChild(a),a.click(),document.body.removeChild(a),g(!1)}catch(t){console.error(t),alert("PDF export failed — check Laravel route and logs.")}},S=()=>{if(!b.current)return;const t=b.current.innerHTML,n=`
      <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
      <style>
        body{font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;}
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #bdbdbd; padding: 8px; text-align: left; font-size: 12px; }
        th { background: #f3f4f6; font-weight: 600; }
        tfoot td { font-weight: 700; background: #f9fafb; }
        .header { text-align:center; margin-bottom: 16px; }
      </style>
    `,s=window.open("","","width=900,height=700");s&&(s.document.write(`
      <html>
        <head><title>Monthly Report</title>${n}</head>
        <body class="p-8">
          <div class="header">
            <img src="/images/jamo-logo-2.png" alt="logo" style="height:60px;margin-bottom:8px" />
            <div style="font-weight:700;font-size:18px">Monthly Cash Position Report</div>
            <div style="font-size:12px;color:#6b7280">Municipality / Office · Address · Contact</div>
            <hr style="margin:12px 0;border:none;border-top:1px solid #e5e7eb"/>
          </div>
          ${t}
          <div style="text-align:center;margin-top:20px;font-size:11px;color:#6b7280">Page 1</div>
        </body>
      </html>
    `),s.document.close(),s.onload=()=>{s.focus(),s.print()})},I=()=>d(t=>Math.max(1,t-1)),M=()=>d(t=>Math.min(y,t+1)),C=t=>d(()=>Math.min(Math.max(1,t),y));return e.jsxs(k,{breadcrumbs:E,children:[e.jsx(A,{title:"Monthly Report"}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-2xl font-bold",children:"Monthly Report"})}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-sm border space-y-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:"Filters"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1",children:"Month"}),e.jsxs("select",{value:x,onChange:t=>{L(t.target.value),d(1)},className:`px-3 py-2 border rounded-md shadow-sm bg-white 
                        focus:ring-2 focus:ring-blue-400 focus:border-blue-400`,children:[e.jsx("option",{value:"",children:"All Months"}),["January","February","March","April","May","June","July","August","September","October","November","December"].map((t,n)=>e.jsx("option",{value:n+1,children:t},n))]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1",children:"Year"}),e.jsxs("select",{value:u,onChange:t=>{N(t.target.value),d(1)},className:`px-3 py-2 border rounded-md shadow-sm bg-white 
                        focus:ring-2 focus:ring-blue-400 focus:border-blue-400`,children:[e.jsx("option",{value:"",children:"All Years"}),Array.from({length:8}).map((t,n)=>{const s=new Date().getFullYear()-n;return e.jsx("option",{value:s,children:s},s)})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-sm font-medium text-gray-600 mb-1",children:"Interest Type"}),e.jsxs("select",{value:m,onChange:t=>{v(t.target.value),d(1)},className:`px-3 py-2 border rounded-md shadow-sm bg-white 
                        focus:ring-2 focus:ring-blue-400 focus:border-blue-400`,children:[e.jsx("option",{value:"ALL",children:"All Interest Types"}),e.jsx("option",{value:"5%",children:"5% Interest"}),e.jsx("option",{value:"10%",children:"10% Interest"})]})]})]})]}),e.jsx("div",{ref:b,children:e.jsx("div",{className:"overflow-hidden rounded-lg border shadow bg-white",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-sm text-gray-700",children:[e.jsx("th",{className:"px-4 py-3",children:"Month"}),e.jsx("th",{className:"px-4 py-3",children:"Loan Released"}),e.jsx("th",{className:"px-4 py-3",children:"6% Deduction"}),e.jsx("th",{className:"px-4 py-3",children:"Advance 10% Interest"}),e.jsx("th",{className:"px-4 py-3",children:"Loan Principal Payment"}),e.jsx("th",{className:"px-4 py-3",children:"Loan Interest Payment"}),e.jsx("th",{className:"px-4 py-3",children:"Interest Type"})]})}),e.jsxs("tbody",{className:"text-sm",children:[D.map((t,n)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2",children:P(t.month)}),e.jsxs("td",{className:"px-4 py-2",children:["₱",t.loanReleased.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",t.sixPercentDeduction.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",t.advanceTenPercentDeduction.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",t.LPP.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",t.LIP.toLocaleString()]}),e.jsx("td",{className:"px-4 py-2",children:t.interestType})]},n)),e.jsxs("tr",{className:"bg-gray-50 font-semibold",children:[e.jsx("td",{className:"px-4 py-2 text-right",children:"Totals:"}),e.jsxs("td",{className:"px-4 py-2",children:["₱",p.loanReleased.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",p.sixPercentDeduction.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",p.advanceTenPercentDeduction.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",p.LPP.toLocaleString()]}),e.jsxs("td",{className:"px-4 py-2",children:["₱",p.LIP.toLocaleString()]}),e.jsx("td",{className:"px-4 py-2"})]})]})]})})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{children:e.jsxs("span",{className:"text-sm text-gray-600",children:["Showing ",(c-1)*h+1," - ",Math.min(c*h,l.length)," of ",l.length]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:I,className:"px-3 py-1 border rounded disabled:opacity-50",disabled:c===1,children:"Prev"}),e.jsx("div",{className:"flex gap-1",children:Array.from({length:y}).map((t,n)=>{const s=n+1;return e.jsx("button",{onClick:()=>C(s),className:`px-3 py-1 rounded ${s===c?"bg-[#FDE68A]":"border"}`,children:s},s)})}),e.jsx("button",{onClick:M,className:"px-3 py-1 border rounded",disabled:c===y,children:"Next"})]})]}),e.jsxs("div",{className:"flex items-center gap-3 justify-end",children:[e.jsx("button",{className:"px-4 py-2 bg-[#D97706] text-white rounded shadow hover:bg-[#C49518]",onClick:S,children:"Print"}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>g(t=>!t),className:"px-4 py-2 bg-[#FABF24] text-white rounded shadow hover:bg-[#C49518]",children:"Export"}),w&&e.jsxs("div",{className:"absolute right-0 mt-2 w-40 bg-white border rounded shadow z-20",children:[e.jsx("button",{onClick:R,className:"w-full text-left px-4 py-2 hover:bg-gray-100",children:"PDF"}),e.jsx("button",{onClick:T,className:"w-full text-left px-4 py-2 hover:bg-gray-100",children:"CSV"})]})]})]})]})]})}export{_ as default};
